<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>贪吃蛇 · 纯前端</title>
  <style>
    :root {
      --bg: radial-gradient(circle at 20% 20%, #1b2a46, #0c1220 40%), radial-gradient(circle at 80% 0%, #13284a, #0c1220 45%), #0c1220;
      --panel: #0f1c33;
      --panel-border: #213554;
      --primary: #79c0ff;
      --accent: #ff7b72;
      --muted: #9fb4d7;
      --shadow: 0 24px 80px rgba(0, 0, 0, 0.45);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--bg);
      color: #e8f1ff;
      font-family: "Segoe UI", "PingFang SC", "Microsoft YaHei", system-ui, -apple-system, sans-serif;
      padding: 24px 12px;
    }
    .card {
      width: min(760px, 95vw);
      background: var(--panel);
      border: 1px solid var(--panel-border);
      border-radius: 18px;
      padding: 20px 20px 24px;
      box-shadow: var(--shadow);
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      margin-bottom: 12px;
    }
    h1 {
      margin: 0;
      font-size: 24px;
      letter-spacing: 0.4px;
    }
    .subtitle {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 14px;
    }
    .scoreboard {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
      margin: 10px 0 14px;
    }
    .badge {
      background: #122544;
      border: 1px solid #1f3354;
      padding: 8px 12px;
      border-radius: 10px;
      font-weight: 600;
      color: #d9e7ff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 22px rgba(0, 0, 0, 0.2);
    }
    .badge.secondary {
      color: var(--muted);
      font-weight: 500;
    }
    .controls {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    button {
      border: 1px solid #26466f;
      background: linear-gradient(145deg, #1a3256, #13233c);
      color: #e8f1ff;
      padding: 10px 14px;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      letter-spacing: 0.3px;
      transition: transform 0.12s ease, box-shadow 0.12s ease, border 0.12s ease;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
    }
    button:hover {
      border-color: #5aa0ff;
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.35);
      transform: translateY(-1px);
    }
    button:active { transform: translateY(0); }
    canvas {
      display: block;
      width: 100%;
      height: auto;
      max-width: 560px;
      aspect-ratio: 1 / 1;
      background: #0c1526;
      border: 1px solid #1f3354;
      border-radius: 14px;
      margin: 0 auto;
      box-shadow: 0 14px 40px rgba(0, 0, 0, 0.35);
    }
    .hint {
      margin: 14px 2px 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
    }
    .hint strong { color: #d0dfff; }
  </style>
</head>
<body>
  <div class="card">
    <header>
      <div>
        <h1>贪吃蛇</h1>
        <p class="subtitle">方向键 / WASD 控制 · 空格暂停或继续</p>
      </div>
      <div class="controls">
        <button id="startBtn">开始 / 重开</button>
        <button id="pauseBtn">暂停</button>
      </div>
    </header>
    <div class="scoreboard">
      <div class="badge">得分 <span id="score">0</span></div>
      <div class="badge secondary">最佳 <span id="best">0</span></div>
      <div class="badge secondary" id="status">准备中</div>
    </div>
    <canvas id="board" width="520" height="520"></canvas>
    <p class="hint">
      吃到闪光苹果可加分并略微加速，撞墙或咬到自己即告结束。
      如需挑战，尽量保持流畅路径；初次尝试可适当暂停调整节奏。
    </p>
  </div>
  <script>
    (() => {
      const canvas = document.getElementById("board");
      const ctx = canvas.getContext("2d");
      const scoreEl = document.getElementById("score");
      const bestEl = document.getElementById("best");
      const statusEl = document.getElementById("status");
      const startBtn = document.getElementById("startBtn");
      const pauseBtn = document.getElementById("pauseBtn");

      const gridCount = 26;
      const cell = canvas.width / gridCount;
      const baseTick = 130;
      const minTick = 55;

      let snake = [];
      let dir = { x: 1, y: 0 };
      let nextDir = { x: 1, y: 0 };
      let apple = { x: 10, y: 10 };
      let score = 0;
      let best = Number(localStorage.getItem("snake-best") || 0);
      let running = false;
      let gameOver = false;
      let lastTime = 0;
      let acc = 0;
      let tick = baseTick;

      bestEl.textContent = best;

      function setStatus(text) {
        statusEl.textContent = text;
      }

      function reset() {
        snake = [
          { x: Math.floor(gridCount / 2), y: Math.floor(gridCount / 2) },
          { x: Math.floor(gridCount / 2) - 1, y: Math.floor(gridCount / 2) },
        ];
        dir = { x: 1, y: 0 };
        nextDir = { ...dir };
        score = 0;
        tick = baseTick;
        scoreEl.textContent = score;
        gameOver = false;
        running = true;
        setStatus("进行中");
        placeApple();
      }

      function placeApple() {
        const occupied = new Set(snake.map((p) => `${p.x},${p.y}`));
        let x, y;
        do {
          x = Math.floor(Math.random() * gridCount);
          y = Math.floor(Math.random() * gridCount);
        } while (occupied.has(`${x},${y}`));
        apple = { x, y };
      }

      function changeDir(nx, ny) {
        if (gameOver) return;
        if (nx === -dir.x && ny === -dir.y) return;
        nextDir = { x: nx, y: ny };
      }

      function updateLogic() {
        dir = nextDir;
        const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
        const hitWall =
          head.x < 0 || head.x >= gridCount || head.y < 0 || head.y >= gridCount;
        const hitSelf = snake.some((p) => p.x === head.x && p.y === head.y);
        if (hitWall || hitSelf) {
          running = false;
          gameOver = true;
          setStatus("游戏结束");
          return;
        }

        snake.unshift(head);
        if (head.x === apple.x && head.y === apple.y) {
          score += 10;
          scoreEl.textContent = score;
          if (score > best) {
            best = score;
            bestEl.textContent = best;
            localStorage.setItem("snake-best", best);
          }
          tick = Math.max(minTick, baseTick - snake.length * 2);
          placeApple();
        } else {
          snake.pop();
        }
      }

      function drawGrid() {
        ctx.strokeStyle = "rgba(255,255,255,0.03)";
        ctx.lineWidth = 1;
        for (let i = 0; i <= gridCount; i++) {
          ctx.beginPath();
          ctx.moveTo(i * cell, 0);
          ctx.lineTo(i * cell, canvas.height);
          ctx.stroke();

          ctx.beginPath();
          ctx.moveTo(0, i * cell);
          ctx.lineTo(canvas.width, i * cell);
          ctx.stroke();
        }
      }

      function draw() {
        ctx.fillStyle = "#0c1526";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        drawGrid();

        ctx.shadowColor = "rgba(255, 123, 114, 0.6)";
        ctx.shadowBlur = 16;
        ctx.fillStyle = "#ff7b72";
        ctx.beginPath();
        ctx.roundRect(
          apple.x * cell + 4,
          apple.y * cell + 4,
          cell - 8,
          cell - 8,
          6
        );
        ctx.fill();
        ctx.shadowBlur = 0;

        snake.forEach((segment, idx) => {
          const isHead = idx === 0;
          ctx.fillStyle = isHead ? "#79c0ff" : "#3aa0ff";
          ctx.strokeStyle = "rgba(255,255,255,0.08)";
          ctx.lineWidth = 1;
          ctx.beginPath();
          ctx.roundRect(
            segment.x * cell + 2,
            segment.y * cell + 2,
            cell - 4,
            cell - 4,
            8
          );
          ctx.fill();
          ctx.stroke();
        });

        if (gameOver) {
          ctx.fillStyle = "rgba(0, 0, 0, 0.55)";
          ctx.fillRect(0, 0, canvas.width, canvas.height);
          ctx.fillStyle = "#e8f1ff";
          ctx.font = "bold 26px 'Segoe UI', 'PingFang SC', sans-serif";
          ctx.textAlign = "center";
          ctx.fillText("游戏结束 - 按下开始重来", canvas.width / 2, canvas.height / 2);
          ctx.textAlign = "left";
        }
      }

      function loop(timestamp) {
        if (!lastTime) lastTime = timestamp;
        const delta = timestamp - lastTime;
        lastTime = timestamp;
        if (running) {
          acc += delta;
          while (acc >= tick) {
            updateLogic();
            acc -= tick;
          }
        }
        draw();
        requestAnimationFrame(loop);
      }

      function togglePause() {
        if (gameOver) return;
        running = !running;
        setStatus(running ? "进行中" : "已暂停");
        pauseBtn.textContent = running ? "暂停" : "继续";
      }

      window.addEventListener("keydown", (e) => {
        const key = e.key.toLowerCase();
        if (["arrowup", "w"].includes(key)) changeDir(0, -1);
        else if (["arrowdown", "s"].includes(key)) changeDir(0, 1);
        else if (["arrowleft", "a"].includes(key)) changeDir(-1, 0);
        else if (["arrowright", "d"].includes(key)) changeDir(1, 0);
        else if (key === " ") {
          e.preventDefault();
          togglePause();
        }
      });

      startBtn.addEventListener("click", () => {
        reset();
        pauseBtn.textContent = "暂停";
      });

      pauseBtn.addEventListener("click", togglePause);

      // 初始状态：显示棋盘与苹果但不移动
      draw();
      setStatus("准备中");
      requestAnimationFrame(loop);
    })();
  </script>
</body>
</html>
